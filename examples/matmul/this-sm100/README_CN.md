代码参考自 https://github.com/deepseek-ai/DeepGEMM/blob/main/deep_gemm/include/deep_gemm/impls/sm100_bf16_gemm.cuh 以及 https://github.com/deepseek-ai/DeepGEMM/tree/main/deep_gemm/include/deep_gemm/common/ .

在参考代码的基础上做了部分简化和修改，最终代码为 400 行左右（包括 host/device 代码，头文件仅依赖 cuda/cutlass/cute，对 cutlass/cute 的依赖仅包括其对一些指令的封装）。部分修改内容如下：
- 原版会对 k-loop 额外做一个 tile-size=num-stages 的 unrolled tiling，优点是 stage-idx 可以变为编译期常量，然后 phase 的翻转只需要在 inner-loop 结束时进行，减少了一部分状态更新的开销，缺点是 k-loop-length 不被 num-stage 整除的情况下，尾块部分需要 producer & consumer 同步对齐，以保证下一个 mn-iter (persistent-loop) 的初始 stage-idx=0，但这样 producer 就不会直接执行下一个 mn-iter，而是会等待 consumer 当前的 mn-iter 结束， 会有一些流水线的空泡，而且这个会对代码引入额外的复杂性。 改版将这个 tiling 取消，stage/phase 等作为跨 mn-loop 和 k-loop 的全局状态进行维护，在每个 k-iter 结束时进行状态更新。
- 删去了对 TMEM 有依赖的 worker (UMMA warp, Epilogue warpgroup) 在 barrier-wait 后或 barrier-arrive 前执行 tcgen05.fence::after_thread_sync 或 tcgen05.fence::before_thread_sync 的代码。测试发现这两者对正确性似乎没有影响，CUTLASS 代码中也没有对这两个指令的使用。
- 对 kernel 中涉及的三个 pipeline (SMEM-AB, TMEM-C, SMEM-C) 都用统一的接口维护了各自的全局 pipeline state。
- 将代码结构了重整并添加了对应的注释，重整后的整体结构为：
	- tma-descriptors prefetching 
	- shared-memory buffer/barrier allocation 
	- tensor-memory buffer allocation 
	- barrier initialization
	- TMA-Load worker (CTA0/1-Warp0-Lane0)
		- mn-loop (persistent)
			- k-loop
				- SMEM-AB-pipeline: wait-consumer-empty
				- SMEM-AB-pipeline: producer-execute
					- `cute::SM100_TMA_2SM_LOAD_2D`
				- SMEM-AB-pipeline: commit-producer-ready
				- SMEM-AB-pipeline: producer-next-stage
	- UMMA worker (CTA0-Warp1-Lane0)
		- mn-loop (persistent)
			- TMEM-C-pipeline: wait-consumer-empty
			- TMEM-C-pipeline: producer-execute
				- k-loop 
					- SMEM-AB-pipeline: wait-producer-ready
					- SMEM-AB-pipeline: consumer-execute
						- `cute::SM100_MMA_F16BF16_2x1SM_SS`
					- SMEM-AB-pipeline: commit-consumer-empty
					- SMEM-AB-pipeline: consumer-next-stage
			- TMEM-C-pipeline: commit-producer-ready
			- TMEM-C-pipeline: producer-next-stage
	- Epilogue worker (CTA0/1-Warp4/5/6/7)
		- mn-loop (persistent)
			- TMEM-C-pipeline: wait-producer-ready
			- TMEM-C-pipeline: consumer-execute
				- mn-inner-loop 
					- SMEM-C-pipeline: wait-consumer-empty
					- SMEM-C-pipeline: producer-execute
						- `cute::SM100_TMEM_LOAD_32dp32b8x`
						- `st.shared.v4.u32` 
					- SMEM-C-pipeline: commit-producer-ready
					- SMEM-C-pipeline: wait-producer-ready
					- SMEM-C-pipeline: consumer-execute
						- `cute::SM90_TMA_STORE_2D`
					- SMEM-C-pipeline: commit-consumer-empty
					- SMEM-C-pipeline: next-stage
			- TMEM-C-pipeline: commit-consumer-empty
			- TMEM-C-pipeline: consumer-next-stage
- 仅保留 MultiCast=2 的情况，也就是在一个 CTA-Pair 的范围内做 UMMA。
- 仅保留 GemmType::Normal 的情况，删去了处理 GroupGEMM 的逻辑（主要影响 scheduler 代码）。
- 分块大小预设为每个 CTA 处理 MxNxK=256x256x64 的计算（每个 CTA-Pair 处理 512x256x64 的计算）。
